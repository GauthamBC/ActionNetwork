<section class="vi-compact-embed" role="region" aria-labelledby="vi-compact-embed-title"
  style="max-width:860px;margin:16px auto;font:14px/1.35 Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
         color:#181a1f;background:#ffffff;border:1px solid #DCEFE6;border-radius:12px;
         box-shadow:0 1px 2px rgba(0,0,0,.04),0 6px 16px rgba(0,0,0,.05);overflow:hidden;">
  <style>
    .vi-compact-embed *{box-sizing:border-box}
    .vi-compact-embed{color-scheme:light}
    .vi-compact-embed{
      --brand-50:#F6FFF9; --brand-100:#DCF2EB; --brand-300:#BCE5D6;
      --brand-500:#56C257; --brand-600:#3FA94B; --brand-700:#2E8538; --brand-900:#1F5D28;
      --ink:#181a1f; --muted:#666b73; --border:#DCEFE6; --viz-h:88px;
      --hover-tint: rgba(86,194,87,.12); --hover-ring:#BCE5D6; --hover-shadow:0 10px 24px rgba(86,194,87,.18);
    }

    /* Header */
    .vi-compact-embed .head{
      padding:14px 16px;border-bottom:1px solid var(--border)!important;color:#fff!important;
      background:
        radial-gradient(120% 140% at 85% 10%, rgba(255,255,255,.10) 0%, transparent 60%),
        linear-gradient(90deg,var(--brand-900) 0%,var(--brand-600) 45%,var(--brand-500) 100%)!important;
    }
    .vi-compact-embed .title{margin:0 0 2px;font-size:clamp(16px,2.2vw,20px);line-height:1.2;font-weight:800;color:#fff!important}
    .vi-compact-embed .sub{margin:0;color:rgba(255,255,255,.92)!important;font-size:12px}
    .vi-compact-embed .meta{margin:4px 0 0;color:rgba(255,255,255,.85)!important;font-size:12px}

    /* Rows */
    .vi-compact-embed .table{padding:10px 12px}
    .vi-compact-embed .row{
      display:grid;grid-template-columns:36px 1fr minmax(240px,48%);gap:8px;align-items:center;margin:6px 0;
      border:1px solid var(--border)!important;border-radius:12px;padding:8px 10px;background:#fff!important;
      transition:transform .18s cubic-bezier(.2,.8,.2,1),box-shadow .18s ease,background-color .15s ease,border-color .15s ease;
      transform-origin:center;
    }
    .vi-compact-embed .row:hover,.vi-compact-embed .row:focus-within{
      background:linear-gradient(0deg,var(--hover-tint),var(--hover-tint)),#fff!important;
      transform:scale(1.01);box-shadow:var(--hover-shadow);border-color:var(--hover-ring)!important;
    }
    @media (prefers-reduced-motion:reduce){.vi-compact-embed .row{transition:none}.vi-compact-embed .row:hover,.vi-compact-embed .row:focus-within{transform:none;box-shadow:none}}
    @media (max-width:640px){.vi-compact-embed .row{grid-template-columns:30px 1fr}.vi-compact-embed .metric{grid-column:1 / -1}}

    .vi-compact-embed .rank{display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--muted)}
    .vi-compact-embed .state{display:flex;align-items:center;gap:8px;font-weight:700;color:var(--ink)}
    .vi-compact-embed .chip{width:18px;height:18px;border-radius:50%;overflow:hidden;border:1px solid #cfe4da;background:#fff;flex-shrink:0}
    .vi-compact-embed .chip img{width:100%;height:100%;object-fit:cover}

    .vi-compact-embed .metric{position:relative;height:28px;border-radius:999px;background:rgba(86,194,87,.10)!important;overflow:hidden}
    .vi-compact-embed .bar{position:absolute;inset:0 auto 0 0;border-radius:999px;background:linear-gradient(90deg,var(--brand-600),var(--brand-500))!important;box-shadow:inset 0 0 0 1px rgba(0,0,0,.04)}
    .vi-compact-embed .val{position:absolute;right:6px;top:50%;transform:translateY(-50%);font-variant-numeric:tabular-nums;font-weight:800;font-size:13px;color:#0e1a12!important;background:#fff!important;border:2px solid #e6e9ed!important;border-radius:999px;padding:2px 8px}

    /* Gradient bars by rank */
    .vi-compact-embed .row[data-rank="1"]  .bar{background:linear-gradient(90deg,#1F5D28,#56C257)!important}
    .vi-compact-embed .row[data-rank="2"]  .bar{background:linear-gradient(90deg,#2A7331,#5DC65F)!important}
    .vi-compact-embed .row[data-rank="3"]  .bar{background:linear-gradient(90deg,#2E8538,#63CA67)!important}
    .vi-compact-embed .row[data-rank="4"]  .bar{background:linear-gradient(90deg,#379744,#6ACE70)!important}
    .vi-compact-embed .row[data-rank="5"]  .bar{background:linear-gradient(90deg,#3FA94B,#71D279)!important}
    .vi-compact-embed .row[data-rank="6"]  .bar{background:linear-gradient(90deg,#52B760,#7AD783)!important}
    .vi-compact-embed .row[data-rank="7"]  .bar{background:linear-gradient(90deg,#64C274,#84DB8E)!important}
    .vi-compact-embed .row[data-rank="8"]  .bar{background:linear-gradient(90deg,#76CC88,#8FE099)!important}
    .vi-compact-embed .row[data-rank="9"]  .bar{background:linear-gradient(90deg,#8AD79D,#9AE5A5)!important}
    .vi-compact-embed .row[data-rank="10"] .bar{background:linear-gradient(90deg,#9FE1B3,#A7E6BA)!important}

    /* Details panel */
    .vi-compact-embed .details{
      margin:0;padding:0;border:1px solid var(--border);border-width:0;border-radius:12px;background:var(--brand-50);
      max-height:0;opacity:0;overflow:hidden;transform:translateY(-6px);
      transition:max-height .28s ease,opacity .28s ease,transform .28s ease,padding .20s ease,margin .20s ease,border-width .20s ease;
    }
    .vi-compact-embed .details.open{margin:8px 0 12px;padding:12px;border-width:1px;max-height:420px;opacity:1;transform:translateY(0)}
    .vi-compact-embed .metrics-title{margin:0 0 10px;font-weight:800;font-size:14px;color:var(--brand-900)}
    .vi-compact-embed .metrics-grid{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:10px}
    @media (max-width:640px){.vi-compact-embed .metrics-grid{grid-template-columns:repeat(2,minmax(0,1fr))}}

    /* Cards (grid: label → number → viz → caption) */
    .vi-compact-embed .metric-card{
      background:#fff;border:1px solid var(--border);border-radius:10px;padding:16px 12px 12px;
      display:grid;grid-template-rows:auto auto var(--viz-h) auto;gap:8px;align-content:start;
    }
    .vi-compact-embed .metric-label{font-size:12px;color:var(--muted);font-weight:700;margin:0;line-height:1.2}
    .vi-compact-embed .metric-number{font-weight:800;font-size:20px;color:#0e1a12;margin:0;line-height:1.1;font-variant-numeric:tabular-nums}
    .vi-compact-embed .metric-scale{font-size:11px;color:#8a9099;margin:0}

    /* Sparkline (elevation) */
    .vi-compact-embed .spark{align-self:center}
    .vi-compact-embed .spark svg{width:100%;height:var(--viz-h)}
    .vi-compact-embed .spark-base{stroke:#e6f1ec;stroke-width:3;fill:none}
    .vi-compact-embed .spark-line{stroke:url(#az-elev-grad);stroke-width:4;fill:none;stroke-linecap:round;transition:stroke-dashoffset .6s ease}
    .vi-compact-embed .spark-dot{fill:var(--brand-500);stroke:#fff;stroke-width:2}
    .vi-compact-embed .donut > div{display:contents}
    .vi-compact-embed .donut circle.bg{stroke:#e6f4ee;stroke-width:10;fill:none}
    .vi-compact-embed .donut circle.fg{stroke:var(--brand-600);stroke-width:10;fill:none;stroke-linecap:round;transform:rotate(-90deg);transform-origin:50% 50%;transition:stroke-dashoffset .7s ease}

    /* Mini bars (clear days & humidity) */
    .vi-compact-embed .mini-bar{height:10px;border-radius:999px;background:rgba(86,194,87,.16);overflow:hidden;align-self:center}
    .vi-compact-embed .mini-bar .fill{display:block;height:100%;width:0%;border-radius:999px;background:linear-gradient(90deg,var(--brand-600),var(--brand-500));transition:width .6s ease}

    /* Clickable hint fix */
    .vi-compact-embed .row.is-clickable{cursor:pointer;position:relative}
    .vi-compact-embed .row.is-clickable .metric{padding-right:128px}
    .vi-compact-embed .row.is-clickable::after{
      content:"Click for metrics";position:absolute;right:12px;top:50%;transform:translateY(-50%);
      font-size:11px;color:#7cae85;white-space:nowrap;pointer-events:none;z-index:1;
    }
    .vi-compact-embed .metric .val{z-index:2}
    @media (max-width:640px){.vi-compact-embed .row.is-clickable::after{display:none}}
    .vi-compact-embed .row[aria-expanded="true"]::after{display:none}

    .vi-compact-embed .details-close{margin-top:10px;align-self:flex-end;background:#fff;border:1px solid var(--border);border-radius:999px;padding:6px 10px;font-weight:700;cursor:pointer}
    .vi-compact-embed .details-close:hover{border-color:var(--hover-ring)}

/* === FINAL: compact + equal-height, no extra whitespace === */
.vi-compact-embed{
  --viz-h: 56px;      /* chart height (ring/spark/bar) */
  --card-h: 176px;    /* uniform card height; bump 172–188 if you need a hair more/less */
}

.vi-compact-embed .metrics-grid{
  grid-auto-rows: var(--card-h);
  gap: 10px;
}

.vi-compact-embed .metric-card{
  height: 100%;
  padding: 12px 12px 10px;
  gap: 6px;
  grid-template-rows: auto auto var(--viz-h) auto; /* label → number → viz → caption */
}

.vi-compact-embed .metric-number{ font-size:19px }

.vi-compact-embed .spark svg{ height: var(--viz-h) }

.vi-compact-embed .donut{
  row-gap: 6px;
}
.vi-compact-embed .donut svg{
  width: var(--viz-h);
  height: var(--viz-h);
}
.vi-compact-embed .donut circle.bg,
.vi-compact-embed .donut circle.fg{ stroke-width: 8 }  /* slimmer ring */

.vi-compact-embed .mini-bar{ height: 8px }

.vi-compact-embed .details.open{ padding: 8px } /* tighter panel padding */

/* Bigger donut that uses the free space; no in-chart labels */
.vi-compact-embed{ --donut-h: 88px } /* try 84–100 if you want larger/smaller */

.vi-compact-embed .metric-card:has(.donut){
  grid-template-rows: auto auto var(--donut-h) auto; /* label, number, donut, caption */
}

.vi-compact-embed .donut,
.vi-compact-embed .donut > div{ display:contents }   /* flatten so number stays on row 2 */

.vi-compact-embed .donut svg{
  grid-row:3;                     /* chart row */
  width: var(--donut-h);
  height: var(--donut-h);
  aspect-ratio: 1 / 1;            /* keep it perfectly round */
  justify-self:start;
  align-self:center;
}

/* keep donut ring tidy */
.vi-compact-embed .donut circle.bg,
.vi-compact-embed .donut circle.fg{ stroke-width: 8 }

/* Align bold numbers to the same row across all cards */
.vi-compact-embed .donut,
.vi-compact-embed .donut > div{ display:contents } /* flatten into the card grid */

.vi-compact-embed .donut svg{
  grid-row:3;                /* viz row */
  width:var(--viz-h);
  height:var(--viz-h);
  justify-self:start;
  align-self:center;
}

.vi-compact-embed .donut .metric-number{ grid-row:2 }  /* number row (same as others) */
.vi-compact-embed .donut .metric-scale{  grid-row:4 }  /* caption row */
/* FORCE big donut, aligned numbers, minimal text under charts */
.vi-compact-embed{
  --donut-h: 104px;   /* <- donut size knob (try 96–112) */
  --card-h: 196px;    /* <- card height knob to keep all 4 equal */
}

/* cards are already grid-based; just ensure donut cards allocate a taller viz row */
.vi-compact-embed .metric-card:has(.donut){
  grid-template-rows: auto auto var(--donut-h) auto;
}

/* flatten donut so number/caption stay separate from the ring (no labels in chart) */
.vi-compact-embed .donut,
.vi-compact-embed .donut > div{ display:contents }

/* the ring itself */
.vi-compact-embed .donut svg{
  grid-row:3;                       /* chart row */
  width:var(--donut-h);
  height:var(--donut-h);
  justify-self:start;
  align-self:center;
}
.vi-compact-embed .donut circle.bg,
.vi-compact-embed .donut circle.fg{ stroke-width:8 }  /* clean, slim ring */
/* Calendar viz for Clear Days (no in-chart labels) */
.vi-compact-embed { --cal-h: 80px } /* height of the calendar grid */

.vi-compact-embed .metric-card:has(.calendar){
  grid-template-rows: auto auto var(--cal-h) auto;  /* label, number, calendar, caption */
}

.vi-compact-embed .calendar{
  height: var(--cal-h);
  display: grid;
  grid-template-columns: repeat(6, 1fr);  /* 6 × 5 = 30 cells */
  grid-auto-rows: 1fr;
  gap: 6px;
  align-self: center;
}

.vi-compact-embed .calendar .day{
  border-radius: 6px;
  background: #eaf5ee;                 /* light base */
  position: relative; overflow: hidden;
}

/* full green cells */
.vi-compact-embed .calendar .day.filled{
  background: linear-gradient(180deg, var(--brand-600), var(--brand-500));
}

/* fractional cell (e.g., .2 of a day) */
.vi-compact-embed .calendar .day.partial::after{
  content:""; position:absolute; inset:0;
  width: calc(var(--part, 0) * 100%);
  background: linear-gradient(90deg, var(--brand-600), var(--brand-500));
}
/* === Align all visualizations to the same vertical middle === */
.vi-compact-embed{
  /* one shared visualization row height for every card */
  --viz-row-h: 104px;             /* match your big donut; tweak 96–112 if needed */
  /* keep if you already set these; not required to change here */
  /* --card-h: 196px;  --donut-h: 104px; --viz-h: 56px; --cal-h: 80px; */
}

/* every metric card gets the same row structure (label, number, VIZ, caption) */
.vi-compact-embed .metric-card{
  grid-template-rows: auto auto var(--viz-row-h) auto !important;
}

/* override any per-card row-height rules you added earlier */
.vi-compact-embed .metric-card:has(.donut),
.vi-compact-embed .metric-card:has(.calendar){
  grid-template-rows: auto auto var(--viz-row-h) auto !important;
}

/* center each viz inside that row */
.vi-compact-embed .spark,
.vi-compact-embed .calendar,
.vi-compact-embed .mini-bar{ align-self: center !important; }

/* donut: size up to the shared row height, centered */
.vi-compact-embed .donut svg{
  grid-row: 3;
  width:  min(var(--donut-h, 104px), var(--viz-row-h));
  height: min(var(--donut-h, 104px), var(--viz-row-h));
  justify-self: start;
  align-self: center;
}

/* sparkline & calendar heights respect the shared row height */
.vi-compact-embed .spark svg{
  height: min(var(--viz-h, 56px), calc(var(--viz-row-h) - 2px));
}
.vi-compact-embed .calendar{
  height: var(--viz-row-h);
}

/* bars already auto-center via align-self, but keep a clean look */
.vi-compact-embed .mini-bar{ height: 8px }
/* Center the donut ring horizontally inside its card */
.vi-compact-embed .donut svg{
  justify-self: center !important;
  margin-inline: auto;           /* safe fallback */
  display: block;                /* avoids inline spacing quirks */
}
/* === Narrow-desktop tuning for Action CMS === */
@media (max-width: 980px){
  .vi-compact-embed{
    --viz-row-h: 92px;   /* shared viz row height */
    --donut-h: 92px;     /* donut matches viz row */
    --card-h: 192px;     /* keep all four cards equal height */
  }

  /* switch to 2 columns so cards don't get squished */
  .vi-compact-embed .metrics-grid{
    grid-template-columns: repeat(2, minmax(0,1fr));
    grid-auto-rows: var(--card-h);
    gap: 10px;
  }

  /* slightly tighter padding on narrow widths */
  .vi-compact-embed .metric-card{ padding: 12px 10px 10px }

  /* donut never exceeds card width */
  .vi-compact-embed .donut svg{
    width:  min(var(--donut-h), calc(100% - 16px));
    height: min(var(--donut-h), calc(100% - 16px));
    justify-self: center;            /* stays centered horizontally */
  }

  /* calendar breathes a bit less */
  .vi-compact-embed .calendar{ gap: 5px }
}

@media (max-width: 820px){
  .vi-compact-embed{
    --viz-row-h: 88px;
    --donut-h: 88px;
    --card-h: 188px;
  }
  .vi-compact-embed .metric-number{ font-size: 18px } /* prevents wrap */
}
/* center the donut across the full card width (robust across browsers) */
.vi-compact-embed .donut svg{
  grid-row: 3;
  grid-column: 1 / -1;        /* span full width of the card */
  justify-self: center !important;
  margin-inline: auto;
  display: block;
}

/* narrow-desktop (2-col) tune: make the donut bigger so it doesn't look tiny */
@media (max-width: 980px){
  .vi-compact-embed{
    --viz-row-h: 112px;       /* taller viz row */
    --donut-h: 112px;         /* bigger ring */
    --card-h: 210px;          /* keep all 4 cards equal height */
  }
  /* ensure the calendar & spark fit the taller viz row cleanly */
  .vi-compact-embed .calendar{ height: var(--viz-row-h) }
  .vi-compact-embed .spark svg{ height: calc(var(--viz-row-h) - 2px) }
}

/* safety: if text wraps, keep the number on its own full-width row */
.vi-compact-embed .donut .metric-number,
.vi-compact-embed .donut .metric-scale{ grid-column: 1 / -1 }
    /* === DESKTOP LAYOUT LOCK — always 4 cards in 1 row === */
.vi-compact-embed{
  /* tune these three knobs if you ever want slightly different sizing */
  --viz-row-h: 120px;      /* height of the visualization row */
  --donut-size: 112px;     /* donut ring size */
  --card-h: 220px;         /* equal card height so all 4 match */
}

/* 4 columns, always */
.vi-compact-embed .metrics-grid{
  grid-template-columns: repeat(4, minmax(0,1fr)) !important;
  grid-auto-rows: var(--card-h);
  gap: 12px !important;
}

/* ensure each card follows: label • number • viz • caption */
.vi-compact-embed .metric-card{
  min-width: 0; /* prevents overflow */
  grid-template-rows: auto auto var(--viz-row-h) auto !important;
}

/* ---- Donut: big + centered, no in-chart labels ---- */
.vi-compact-embed .donut,
.vi-compact-embed .donut > div{ display: contents } /* number/caption stay separate */

.vi-compact-embed .donut svg{
  grid-row: 3;
  grid-column: 1 / -1;
  width:  var(--donut-size) !important;
  height: var(--donut-size) !important;
  justify-self: center !important;
  align-self: center !important;
  display: block;               /* robust centering */
  margin-inline: auto;
}

.vi-compact-embed .donut circle.bg,
.vi-compact-embed .donut circle.fg{ stroke-width: 10 }

/* ---- Calendar & spark sized to the shared viz row ---- */
.vi-compact-embed .calendar{ height: var(--viz-row-h) }
.vi-compact-embed .spark svg{ height: var(--viz-row-h) }

/* mini bars stay slim and centered naturally */
.vi-compact-embed .mini-bar{ height: 8px }
  </style>

  <div class="head">
    <h3 id="vi-compact-embed-title" class="title">States Most Likely to Legalize Sports Betting Next</h3>
    <p class="sub">Implied probabilities &amp; equivalent American moneylines</p>
    <p class="meta">Ordered by: Implied Probability • Bars show: Relative probability (normalized to the #1 state). Click <strong>Arizona</strong> to see extra metrics.</p>
  </div>

  <div class="table">
    <div class="row is-clickable" data-state="Arizona" data-rank="1" aria-controls="az-details" aria-expanded="false" tabindex="0" role="button">
      <div class="rank">1</div>
      <div class="state">
        <span class="chip"><img loading="lazy" decoding="async" alt="Arizona flag" width="18" height="18"
          src="https://commons.wikimedia.org/wiki/Special:FilePath/Flag_of_Arizona.svg"></span>
        Arizona
      </div>
      <div class="metric"><span class="bar" style="width:100.00%"></span><span class="val">4.66% (+2046)</span></div>
    </div>

    <div id="az-details" class="details" aria-hidden="true" role="region" aria-labelledby="az-metrics-title">
      <h4 id="az-metrics-title" class="metrics-title">Arizona — Extra Metrics</h4>
      <div class="metrics-grid">
        <div class="metric-card">
          <div class="metric-label">Avg. Elevation</div>
          <div class="metric-number"><span id="az-elev-val">4,100 ft</span></div>
          <div class="spark" aria-hidden="true">
            <svg id="az-elev-spark" viewBox="0 0 160 60" preserveAspectRatio="none">
              <defs>
                <linearGradient id="az-elev-grad" x1="0" y1="0" x2="1" y2="0">
                  <stop offset="0%" stop-color="#2E8538"></stop>
                  <stop offset="100%" stop-color="#56C257"></stop>
                </linearGradient>
              </defs>
              <path class="spark-base" d="M0,58 L160,58"></path>
              <path id="az-elev-line" class="spark-line" d="M0,58 L160,58"></path>
              <circle id="az-elev-dot" class="spark-dot" cx="160" cy="58" r="4"></circle>
            </svg>
          </div>
          <div class="metric-scale">Above sea level</div>
        </div>

        <div class="metric-card">
          <div class="metric-label">Darkness Score (1–5)</div>
          <div class="donut">
            <svg viewBox="0 0 72 72" aria-hidden="true">
              <circle class="bg" cx="36" cy="36" r="26"></circle>
              <circle id="az-dark-arc" class="fg" cx="36" cy="36" r="26" stroke-dasharray="0" stroke-dashoffset="0"></circle>
            </svg>
            <div>
              <div class="metric-number"><span id="az-dark-val" class="num">4.13 / 5</span></div>
              <div class="metric-scale">~82.6% of max darkness</div>
            </div>
          </div>
        </div>

        <div class="metric-card">
          <div class="metric-label">Avg. Clear Days (Nov)</div>
          <div class="metric-number"><span id="az-clear-val">17.2 days</span></div>
          <div id="az-clear-cal" class="calendar" aria-hidden="true"></div>
          <div class="metric-scale">0 • 30</div>
        </div>

        <div class="metric-card">
          <div class="metric-label">Avg. Humidity (Nov)</div>
          <div class="metric-number"><span id="az-humid-val">33%</span></div>
          <div class="mini-bar"><span id="az-humid-fill" class="fill"></span></div>
          <div class="metric-scale">0% • 100%</div>
        </div>
      </div>
      <button id="az-close" class="details-close" type="button" aria-label="Close Arizona metrics">Close ✕</button>
    </div>

    <!-- Other rows (unchanged) -->
    <div class="row"><div class="rank">2</div><div class="state"><span class="chip"><img loading="lazy" decoding="async" alt="New Mexico flag" width="18" height="18" src="https://commons.wikimedia.org/wiki/Special:FilePath/Flag_of_New_Mexico.svg"></span>New Mexico</div><div class="metric"><span class="bar" style="width:99.57%"></span><span class="val">4.64% (+2056)</span></div></div>
    <div class="row"><div class="rank">3</div><div class="state"><span class="chip"><img loading="lazy" decoding="async" alt="Colorado flag" width="18" height="18" src="https://commons.wikimedia.org/wiki/Special:FilePath/Flag_of_Colorado.svg"></span>Colorado</div><div class="metric"><span class="bar" style="width:85.41%"></span><span class="val">3.98% (+2413)</span></div></div>
    <div class="row"><div class="rank">4</div><div class="state"><span class="chip"><img loading="lazy" decoding="async" alt="California flag" width="18" height="18" src="https://commons.wikimedia.org/wiki/Special:FilePath/Flag_of_California.svg"></span>California</div><div class="metric"><span class="bar" style="width:83.48%"></span><span class="val">3.89% (+2471)</span></div></div>
    <div class="row"><div class="rank">5</div><div class="state"><span class="chip"><img loading="lazy" decoding="async" alt="Nevada flag" width="18" height="18" src="https://commons.wikimedia.org/wiki/Special:FilePath/Flag_of_Nevada.svg"></span>Nevada</div><div class="metric"><span class="bar" style="width:75.75%"></span><span class="val">3.53% (+2733)</span></div></div>
    <div class="row"><div class="rank">6</div><div class="state"><span class="chip"><img loading="lazy" decoding="async" alt="Utah flag" width="18" height="18" src="https://commons.wikimedia.org/wiki/Special:FilePath/Flag_of_Utah.svg"></span>Utah</div><div class="metric"><span class="bar" style="width:69.96%"></span><span class="val">3.26% (+2968)</span></div></div>
    <div class="row"><div class="rank">7</div><div class="state"><span class="chip"><img loading="lazy" decoding="async" alt="Texas flag" width="18" height="18" src="https://commons.wikimedia.org/wiki/Special:FilePath/Flag_of_Texas.svg"></span>Texas</div><div class="metric"><span class="bar" style="width:63.09%"></span><span class="val">2.94% (+3292)</span></div></div>
    <div class="row"><div class="rank">8</div><div class="state"><span class="chip"><img loading="lazy" decoding="async" alt="Oklahoma flag" width="18" height="18" src="https://commons.wikimedia.org/wiki/Special:FilePath/Flag_of_Oklahoma.svg"></span>Oklahoma</div><div class="metric"><span class="bar" style="width:57.51%"></span><span class="val">2.68% (+3629)</span></div></div>
    <div class="row"><div class="rank">9</div><div class="state"><span class="chip"><img loading="lazy" decoding="async" alt="Kansas flag" width="18" height="18" src="https://commons.wikimedia.org/wiki/Special:FilePath/Flag_of_Kansas.svg"></span>Kansas</div><div class="metric"><span class="bar" style="width:56.22%"></span><span class="val">2.62% (+3718)</span></div></div>
    <div class="row"><div class="rank">10</div><div class="state"><span class="chip"><img loading="lazy" decoding="async" alt="Wyoming flag" width="18" height="18" src="https://commons.wikimedia.org/wiki/Special:FilePath/Flag_of_Wyoming.svg"></span>Wyoming</div><div class="metric"><span class="bar" style="width:56.01%"></span><span class="val">2.61% (+3733)</span></div></div>
  </div>

  <div class="foot">
    <em>Notes: Moneylines in parentheses. Bars normalized to the top probability. Click Arizona to expand metrics.</em>
  </div>

  <script>
    (function(){
      const rowAZ = document.querySelector('.vi-compact-embed .row[data-state="Arizona"]');
      const panel = document.getElementById('az-details');
      const btnClose = document.getElementById('az-close');
      if(!rowAZ || !panel) return;

      const elevations = [4100,5700,6800,2900,5500,6100,1700,1300,2000,6700];
      const elevMin = Math.min(...elevations);
      const elevMax = Math.max(...elevations);

      const data = { elev:4100, dark:4.13, darkMax:5, clear:17.20, clearMax:30, humid:33.00 };

      function drawElevationSpark(){
        const line = document.getElementById('az-elev-line');
        const dot  = document.getElementById('az-elev-dot');
        const H=60, W=160, pad=2, baselineY=H-pad;
        const pct = (data.elev - elevMin) / Math.max(1,(elevMax - elevMin));
        const yEnd = baselineY - (pct * (H - 12));
        const d = `M0,${baselineY} L${W},${yEnd.toFixed(2)}`;
        line.setAttribute('d', d);
        dot.setAttribute('cx', W);
        dot.setAttribute('cy', yEnd.toFixed(2));
        const pathLen = line.getTotalLength();
        line.style.strokeDasharray = pathLen;
        line.style.strokeDashoffset = pathLen;
        requestAnimationFrame(()=>{ line.style.strokeDashoffset = 0; });
      }

      function animateOtherBars(){
        const clearFill = document.getElementById('az-clear-fill');
        const clearPct = Math.max(0, Math.min(100, data.clear / data.clearMax * 100));
        if(clearFill){ clearFill.style.width = '0%'; requestAnimationFrame(()=> clearFill.style.width = clearPct.toFixed(1)+'%'); }

        const humidFill = document.getElementById('az-humid-fill');
        if(humidFill){ humidFill.style.width = '0%'; requestAnimationFrame(()=> humidFill.style.width = Math.max(0, Math.min(100, data.humid)).toFixed(1)+'%'); }

        const arc = document.getElementById('az-dark-arc');
        if(arc){
          const r=26, C=2*Math.PI*r; arc.style.strokeDasharray=C.toFixed(1); arc.style.strokeDashoffset=C.toFixed(1);
          const pct = Math.max(0, Math.min(1, data.dark / data.darkMax));
          setTimeout(()=> arc.style.strokeDashoffset = (C*(1-pct)).toFixed(1), 30);
        }

        const ez = document.getElementById('az-elev-val'); if(ez) ez.textContent = data.elev.toLocaleString() + ' ft';
        const dz = document.getElementById('az-dark-val'); if(dz) dz.textContent = data.dark.toFixed(2) + ' / ' + data.darkMax;
        const cz = document.getElementById('az-clear-val'); if(cz) cz.textContent = data.clear.toFixed(1) + ' days';
        // Calendar for clear days (30 cells, ~17 green)
const cal = document.getElementById('az-clear-cal');
if (cal && !cal.hasChildNodes()) {
  const total = 30;
  const whole = Math.floor(data.clear);
  const frac  = Math.max(0, Math.min(1, data.clear - whole));

  for (let i = 0; i < total; i++) {
    const cell = document.createElement('span');
    cell.className = 'day';
    if (i < whole) {
      cell.classList.add('filled');
    } else if (i === whole && frac > 0) {
      cell.classList.add('partial');
      cell.style.setProperty('--part', frac.toFixed(2));
    }
    cal.appendChild(cell);
  }
}
        const hz = document.getElementById('az-humid-val'); if(hz) hz.textContent = data.humid.toFixed(0) + '%';
      }

      function togglePanel(){
        const isOpen = panel.classList.toggle('open');
        rowAZ.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
        panel.setAttribute('aria-hidden', isOpen ? 'false' : 'true');
        if(isOpen){ drawElevationSpark(); animateOtherBars(); panel.scrollIntoView({block:'nearest', behavior:'smooth'}); }
      }

      rowAZ.addEventListener('click', togglePanel);
      rowAZ.addEventListener('keydown', e=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); togglePanel(); }});
      if(btnClose) btnClose.addEventListener('click', togglePanel);
      document.addEventListener('keydown', e=>{ if(e.key==='Escape' && panel.classList.contains('open')) togglePanel(); });
    })();
  </script>
</section>
